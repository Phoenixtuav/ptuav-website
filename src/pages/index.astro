---
import Layout from "../layouts/Layout.astro";
import { Navbar } from "@/components/Navbar";
import HeroSection from "@/components/HeroSection";
import { Features } from "@/components/Features";
import { Cases } from "@/components/Cases";
import { Partners } from "@/components/Partners";

// --- 自动获取产品数据逻辑 START ---
// 1. 获取 src/pages/products/ 下所有 markdown 文件
const allProducts = await Astro.glob('./products/*.md');

// 2. 筛选出 frontmatter 中标记了 feature: true 的产品
// 3. 格式化数据以传给组件
const featuredProducts = allProducts
  .filter((post) => post.frontmatter.feature === true)
  .sort((a, b) => (a.frontmatter.order || 99) - (b.frontmatter.order || 99)) // 可选：按 order 排序
  .map((post) => ({
    title: post.frontmatter.title,
    description: post.frontmatter.description,
    image: post.frontmatter.image, // 对应 markdown 里的 image 字段
    url: post.url || '#', // Astro 自动生成的页面路径
  }));
// --- 自动获取产品数据逻辑 END ---
---

<Layout title="Astro Tech - 构建未来智能架构">
  <main class="bg-black w-full min-h-screen">
    <Navbar client:load />
    
    <HeroSection client:load />
    
    <Features client:load products={featuredProducts} />
    
    <Cases client:load />

    <Partners client:load />
    
    </main>
</Layout>