---
import { getCollection, render } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
  const products = await getCollection('products');
  return products.map(product => ({
    params: { slug: product.id },
    props: { product },
  }));
}

// Ensure product is typed correctly
const { product } = Astro.props as { product: any };
const { Content } = await render(product);
---

<Layout title={`${product.data.title} - 产品详情`}>
  
  <div class="min-h-screen bg-white dark:bg-black transition-colors duration-300 relative ">
    
    {/* 全局背景氛围：保留，增加页面层次感 */}
    <div class="absolute top-0 -left-4 w-96 h-96 bg-blue-500 rounded-full mix-blend-multiply filter blur-3xl opacity-10 animate-blob pointer-events-none z-0"></div>
    <div class="absolute top-0 -right-4 w-96 h-96 bg-purple-500 rounded-full mix-blend-multiply filter blur-3xl opacity-10 animate-blob animation-delay-2000 pointer-events-none z-0"></div>

    <main class="relative pt-32 pb-20 px-6 sm:px-8 lg:px-12 max-w-7xl mx-auto z-10">
      
      {/* 顶部导航 */}
      <nav class="flex items-center text-sm text-neutral-500 dark:text-neutral-400 mb-8">
        <a href="/products" class="hover:text-blue-500 transition-colors flex items-center gap-1">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
          返回产品列表
        </a>
      </nav>

      {/* Hero 区域 */}
      <div class="grid lg:grid-cols-2 gap-12 lg:gap-20 items-center mb-24">
        
        {/* 左侧：信息 */}
        <div class="order-2 lg:order-1 flex flex-col items-start space-y-6">
          {product.data.feature && (
             <div class="inline-flex items-center px-3 py-1 rounded-full border border-blue-500/30 bg-blue-500/10 text-blue-600 dark:text-blue-400 text-xs font-medium tracking-wider uppercase">
               Featured Product
             </div>
          )}
          
          <h1 
            class="text-4xl md:text-6xl lg:text-7xl font-bold text-neutral-900 dark:text-white tracking-tight leading-[1.1]"
            transition:name={`title-${product.id}`}
          >
            {product.data.title}
          </h1>
          
          <p class="text-lg md:text-xl text-neutral-600 dark:text-neutral-400 leading-relaxed max-w-2xl border-l-2 border-neutral-200 dark:border-neutral-800 pl-4">
            {product.data.description}
          </p>

          <div class="flex flex-wrap gap-4 pt-4 w-full sm:w-auto">
            <a href="#details" class="flex-1 sm:flex-none text-center px-8 py-3.5 rounded-full border border-neutral-200 dark:border-white/20 text-neutral-900 dark:text-white font-semibold hover:bg-neutral-100 dark:hover:bg-white/10 transition-colors">
              查看详情
            </a>
          </div>
        </div>

        {/* 右侧：产品视觉图 */}
        <div class="order-1 lg:order-2 relative group flex justify-center items-center">
          
          {/* 修改：删除了悬浮光影 (Backdrop Glow) 的 div */}

          {/* 图片容器：纯净无框 */}
          <div class="relative z-10 rounded-2xl w-full flex items-center justify-center">
            <img 
              src={product.data.image} 
              alt={product.data.title} 
              class="w-full h-full object-cover transform transition-transform duration-700 group-hover:scale-105"
              transition:name={`image-${product.id}`} 
            />
            
            {/* 修改：删除了渐变遮罩 (Gradient Mask) 的 div */}
          </div>
          
        </div>
      </div>

      {/* 4. 详细内容区域 */}
      <div id="details" class="relative">
        <div class="absolute inset-0 flex items-center" aria-hidden="true">
          <div class="w-full border-t border-neutral-200 dark:border-neutral-800"></div>
        </div>
        <div class="relative flex justify-center">
          <span class="bg-white dark:bg-black px-4 text-sm text-neutral-500">详细介绍</span>
        </div>
      </div>

      <div class="pt-16 lg:pt-24 max-w-4xl mx-auto">
        <article class="prose prose-lg dark:prose-invert max-w-none 
          prose-headings:font-bold prose-headings:tracking-tight prose-headings:text-neutral-900 dark:prose-headings:text-white
          prose-p:text-neutral-600 dark:prose-p:text-neutral-400 prose-p:leading-8
          prose-a:text-blue-600 dark:prose-a:text-blue-400 prose-a:no-underline hover:prose-a:underline
          prose-img:rounded-xl prose-img:shadow-none prose-img:border-0 
          prose-blockquote:border-l-4 prose-blockquote:border-blue-500 prose-blockquote:bg-neutral-50 dark:prose-blockquote:bg-neutral-900/50 prose-blockquote:py-1 prose-blockquote:px-4 prose-blockquote:rounded-r-lg">
          <Content />
        </article>
      </div>

    </main>
  </div>
</Layout>